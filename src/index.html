<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="stylesheet" href="../dist/style.css">
  <title>Home Test from Canonical</title>
</head>
<body>
   <div class="latest-posts-container">
        <div class="latest-posts row u-equal-height"></div>
   </div> 
   </div>


</body>
<script>
    const url = "https://people.canonical.com/~anthonydillon/wp-json/wp/v2/posts.json";
    const postsContainer = document.querySelector(".latest-posts");

    fetch(url)
    .then(response => response.json())
    .then(data => {
        data.map(post => {
            console.log(data);
            const date = new Date(post.date).toLocaleDateString('en-GB', {  
                day:   'numeric',
                month: 'short',
                year:  'numeric',
            });;

            let category_index = 0;
            let categories = "";
            let category = post._embedded["wp:term"][0][category_index];

            while (typeof category !== 'undefined') {
                categories += category.name + " ";
                ++category_index;
                category = post._embedded["wp:term"][0][category_index];
            }

            let topic_index = 0;
            let topics = "";
            let topic = post._embedded["wp:term"][2][topic_index];

            while (typeof topic !== 'undefined') {
                console.log(topic);
                topics += topic.name + " ";
                ++topic_index;
                topic = post._embedded["wp:term"][2][topic_index];
            }

            if (topics == "") topics = "Cloud And Server";

            const author = post._embedded.author[0];

            const innerContent = `
            <div class="p-card col-4">
                <h5 class="topic">${topics}</h5>
                <hr class="hr-dotted">
                <div class="blog-img">
                    <a href="${post.link}"><img width="380" src="${post.featured_media}" alt=""/></a>
                </div>
                <div class="p-card__content">
                    <h3 class="p-card__title class="blue"><a href="${post.link}">${post.title.rendered}</a></h3>
                    <p><em>By <a href="${author.link}" class="blue">${author.name}</a> on ${date}</em></p>
                    <hr class="hr-dotted">
                    <p class="p-heading--4 blog-category">${categories}</p>
                </div>
            </div>
            `

            postsContainer.innerHTML += innerContent;
        })
    });

</script>
</html>